2025-04-01 21:00:11,761 - ui.main_app - INFO - Misalignment Detection Application started
2025-04-01 21:00:11,762 - ui.main_app - INFO - Created new session: session_20250401_210011_b1b1200e
2025-04-01 21:00:22,140 - ui.main_app - INFO - Settings updated: {'camera1_device': 0, 'camera2_device': 1, 'camera_width': 640, 'camera_height': 480, 'audio_sample_rate': 48000, 'analysis_interval_ms': 1000, 'facial_weight': 0.4, 'llm_weight': 0.6}
2025-04-01 21:00:29,796 - numexpr.utils - INFO - Note: NumExpr detected 24 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 8.
2025-04-01 21:00:29,796 - numexpr.utils - INFO - NumExpr defaulting to 8 threads.
2025-04-01 21:00:30,634 - ui.main_app - INFO - Initializing system components...
2025-04-01 21:00:30,635 - core.camera_manager - INFO - Initialized Camera Manager
2025-04-01 21:00:30,636 - core.camera_manager - INFO - Initialized camera for participant1 with device ID 0
2025-04-01 21:00:30,636 - core.camera_manager - INFO - Added participant participant1 with camera 0
2025-04-01 21:00:30,636 - core.camera_manager - INFO - Initialized camera for participant2 with device ID 1
2025-04-01 21:00:30,636 - core.camera_manager - INFO - Added participant participant2 with camera 1
2025-04-01 21:00:30,637 - core.audio_manager - INFO - Initialized Audio Manager
2025-04-01 21:00:30,637 - core.llm_analyzer - INFO - Initialized LLM Analyzer with Gemma 3.1b
2025-04-01 21:00:30,637 - core.detector - INFO - Initialized Misalignment Detector
2025-04-01 21:00:30,638 - core.data_logger - INFO - Initialized DataLogger
2025-04-01 21:00:30,646 - api.export_service - INFO - Initialized Export Service
2025-04-01 21:00:30,646 - api.websocket_server - INFO - Initialized WebSocket Server on localhost:8765
2025-04-01 21:00:30,646 - ui.main_app - INFO - Starting system components...
2025-04-01 21:00:49,111 - core.camera_manager - INFO - Started camera for participant1: 640x480 at 30.0 FPS
2025-04-01 21:00:49,484 - core.camera_manager - INFO - Started camera for participant2: 640x480 at 30.00003000003 FPS
2025-04-01 21:00:49,591 - core.audio_manager - INFO - Started audio recording and transcription
2025-04-01 21:00:49,592 - core.llm_analyzer - INFO - Started LLM Analyzer
2025-04-01 21:00:49,592 - core.detector - INFO - Started Misalignment Detector
2025-04-01 21:00:49,592 - core.data_logger - INFO - Started DataLogger
2025-04-01 21:00:49,593 - api.websocket_server - INFO - Started WebSocket Server on localhost:8765
2025-04-01 21:00:49,594 - ui.main_app - INFO - Detection started successfully
2025-04-01 21:00:49,646 - websockets.server - INFO - server listening on [::1]:8765
2025-04-01 21:00:49,646 - websockets.server - INFO - server listening on 127.0.0.1:8765
2025-04-01 21:00:59,617 - core.audio_manager - INFO - Saved audio segment: C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\audio\segment_20250401_210059_0.wav
2025-04-01 21:01:09,616 - core.audio_manager - INFO - Saved audio segment: C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\audio\segment_20250401_210109_1.wav
2025-04-01 21:01:15,906 - core.llm_analyzer - ERROR - Gemma API error: {"error":"model 'gemma:3b' not found"}
2025-04-01 21:01:19,616 - core.audio_manager - INFO - Saved audio segment: C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\audio\segment_20250401_210119_2.wav
2025-04-01 21:01:25,952 - core.llm_analyzer - ERROR - Gemma API error: {"error":"model 'gemma:3b' not found"}
2025-04-01 21:01:29,626 - core.audio_manager - INFO - Saved audio segment: C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\audio\segment_20250401_210129_3.wav
2025-04-01 21:01:36,033 - core.llm_analyzer - ERROR - Gemma API error: {"error":"model 'gemma:3b' not found"}
2025-04-01 21:01:39,633 - core.audio_manager - INFO - Saved audio segment: C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\audio\segment_20250401_210139_4.wav
2025-04-01 21:01:46,122 - core.llm_analyzer - ERROR - Gemma API error: {"error":"model 'gemma:3b' not found"}
2025-04-01 21:01:49,643 - core.audio_manager - INFO - Saved audio segment: C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\audio\segment_20250401_210149_5.wav
2025-04-01 21:01:59,637 - core.audio_manager - INFO - Saved audio segment: C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\audio\segment_20250401_210159_6.wav
2025-04-01 21:02:05,323 - core.llm_analyzer - ERROR - Gemma API error: {"error":"model 'gemma:3b' not found"}
2025-04-01 21:02:09,648 - core.audio_manager - INFO - Saved audio segment: C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\audio\segment_20250401_210209_7.wav
2025-04-01 21:02:13,357 - api.websocket_server - ERROR - Exception: object bool can't be used in 'await' expression | Additional Info: Error starting WebSocket server
2025-04-01 21:02:13,367 - api.websocket_server - ERROR - Traceback (most recent call last):
  File "C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\api\websocket_server.py", line 219, in _start_server
    await self.stop_event.wait()
TypeError: object bool can't be used in 'await' expression

2025-04-01 21:02:13,368 - api.websocket_server - ERROR - Exception: [WebSocketServer] Exception: object bool can't be used in 'await' expression | Additional Info: Error starting WebSocket server (Code: None) | Additional Info: Error in WebSocket server thread
2025-04-01 21:02:13,378 - api.websocket_server - ERROR - Traceback (most recent call last):
  File "C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\api\websocket_server.py", line 219, in _start_server
    await self.stop_event.wait()
TypeError: object bool can't be used in 'await' expression

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\api\websocket_server.py", line 235, in _run_server
    loop.run_until_complete(self._start_server())
  File "C:\Users\tg469\.conda\envs\misalign\lib\asyncio\base_events.py", line 649, in run_until_complete
    return future.result()
  File "C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\api\websocket_server.py", line 227, in _start_server
    raise WebSocketError(error_msg)
utils.error_handler.WebSocketError: [WebSocketServer] Exception: object bool can't be used in 'await' expression | Additional Info: Error starting WebSocket server (Code: None)

2025-04-01 21:02:13,379 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-3' coro=<IocpProactor.accept.<locals>.accept_coro() running at C:\Users\tg469\.conda\envs\misalign\lib\asyncio\windows_events.py:580> wait_for=<_OverlappedFuture cancelled>>
2025-04-01 21:02:13,380 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task pending name='Task-4' coro=<IocpProactor.accept.<locals>.accept_coro() running at C:\Users\tg469\.conda\envs\misalign\lib\asyncio\windows_events.py:580> wait_for=<_OverlappedFuture cancelled>>
2025-04-01 21:02:13,380 - api.websocket_server - INFO - Stopped WebSocket Server
2025-04-01 21:02:13,487 - core.data_logger - INFO - Exported session data to C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\data\sessions\session_20250401_210011_b1b1200e\logs\session_export.json
2025-04-01 21:02:13,488 - core.data_logger - INFO - Stopped DataLogger
2025-04-01 21:02:13,572 - core.detector - INFO - Stopped Misalignment Detector
2025-04-01 21:02:15,420 - core.llm_analyzer - ERROR - Gemma API error: {"error":"model 'gemma:3b' not found"}
2025-04-01 21:02:15,421 - core.llm_analyzer - INFO - Stopped LLM Analyzer
2025-04-01 21:02:15,438 - core.audio_manager - ERROR - Exception: sample width not specified | Additional Info: Error saving audio segment
2025-04-01 21:02:15,458 - core.audio_manager - ERROR - Traceback (most recent call last):
  File "C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\core\audio_manager.py", line 190, in _save_current_segment
    wf.setsampwidth(self.py_audio.get_sample_size(self.format))
AttributeError: 'NoneType' object has no attribute 'get_sample_size'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\tg469\Projects\PhD_Projects\AIBO\Dev\Misalign_Detector\core\audio_manager.py", line 188, in _save_current_segment
    with wave.open(segment_file, 'wb') as wf:
  File "C:\Users\tg469\.conda\envs\misalign\lib\wave.py", line 332, in __exit__
    self.close()
  File "C:\Users\tg469\.conda\envs\misalign\lib\wave.py", line 444, in close
    self._ensure_header_written(0)
  File "C:\Users\tg469\.conda\envs\misalign\lib\wave.py", line 464, in _ensure_header_written
    raise Error('sample width not specified')
wave.Error: sample width not specified

2025-04-01 21:02:15,459 - core.audio_manager - INFO - Stopped audio recording and transcription
2025-04-01 21:02:17,894 - core.camera_manager - INFO - Stopped camera for participant1
2025-04-01 21:02:19,919 - core.camera_manager - INFO - Stopped camera for participant2
2025-04-01 21:02:19,919 - core.camera_manager - INFO - Stopped all cameras
2025-04-01 21:02:19,919 - ui.main_app - INFO - Detection stopped successfully
2025-04-01 21:03:18,970 - ui.main_app - INFO - Application shutdown complete
